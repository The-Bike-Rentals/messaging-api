name: Docker Build and Push

on:
    workflow_dispatch:
        inputs:
            branch:
                description: 'Branch to build'
                required: true
                default: 'development'
                type: string
    push:
        branches:
        - development
        - main

jobs:
    DockerBuildPush:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v3
              with:
                  fetch-depth: 0
            - name: Login to DockerHub
              uses: docker/login-action@v2
              with:
                    username: ${{ secrets.DOCKERHUB_USERNAME }}
                    password: ${{ secrets.DOCKERHUB_TOKEN }}

            - name: Docker Build
              uses: docker/build-push-action@v3.2.0
              with: 
                    file: ./Dockerfile
                    tags: hiteshdutt/whatsapp-api:${{ github.run_id }}
                    push: true